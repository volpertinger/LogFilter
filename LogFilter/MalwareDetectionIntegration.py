import subprocess
import json
from Domain.SettingsDomain import Settings
from Domain.LogDomain import Event


def callCppProgram(input_str: str, path: str):
    try:
        # Вызываем C++ программу с использованием subprocess
        result = subprocess.run(
            [path] + [input_str], capture_output=True, text=True, check=True
        )
        # Получаем вывод программы
        output_string = result.stdout.strip()
        return output_string
    except subprocess.CalledProcessError as e:
        return None


def detectionProcessing(events: list, settings: Settings):
    if not settings.malware_detection.enabled:
        return None
    for event in events:
        input_str = json.dumps(event.__dict__())
        output_str = callCppProgram(input_str, settings.malware_detection.programm_path)
        if output_str != None:
            return output_str
    return None
